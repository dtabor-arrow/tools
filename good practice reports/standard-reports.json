[
    {
     "name": "[CHPS] Azure Commitment Discount Consumption - Daily",
     "description": "This report shows your Azure commitment discount consumption per day.\n\nCreated by CloudHealth Professional Services.",
     "backlinking": "True",
     "dataGranularity": "DAILY",
     "timeRange": "30",
     "limit": "-1",
     "excludeCurrent": "True",
     "sqlStatement": "SELECT timeInterval_Day AS Day, SubscriptionName AS Subscription_Name, ConsumedService AS Consumed_Service, BenefitName AS Benefit_Name, PricingModel AS Pricing_Model, ChargeType AS Charge_Type, SUM(AmortizedCostInBillingCurrency) AS SUM_Amortized_Cost FROM AZURE_COST_USAGE WHERE MetricType = 'Amortized' AND (BenefitId IS NOT NULL) GROUP BY timeInterval_Day, SubscriptionName, ConsumedService, BenefitName, PricingModel, ChargeType ORDER BY Day ASC"
    },
   {
     "name": "[CHPS] Azure Commitment Discount Consumption - Monthly",
     "description": "This report shows your Azure commitment discount consumption per month.\n\nCreated by CloudHealth Professional Services.",
     "backlinking": "True",
     "dataGranularity": "MONTHLY",
     "timeRange": "12",
     "limit": "-1",
     "excludeCurrent": "True",
     "sqlStatement": "SELECT timeInterval_Month AS Month, SubscriptionName AS Subscription_Name, ConsumedService AS Consumed_Service, BenefitName AS Benefit_Name, SUM(CostInBillingCurrency) AS Cost, PricingModel AS Pricing_Model, ChargeType AS Charge_Type FROM AZURE_COST_USAGE WHERE MetricType = 'Amortized' AND BenefitId IS NOT NULL GROUP BY timeInterval_Month, SubscriptionName, ConsumedService, BenefitName, PricingModel, ChargeType ORDER BY Month ASC"
    },
   {
     "name": "[CHPS] Azure Cost Coverage From RISP - Daily",
     "description": "This report shows your daily Azure costs that were covered by an RI or SP.\n\nCreated by CloudHealth Professional Services.",
     "backlinking": "True",
     "dataGranularity": "DAILY",
     "timeRange": "90",
     "limit": "-1",
     "excludeCurrent": "True",
     "sqlStatement": "SELECT timeInterval_Day AS Day, ConsumedService AS Consumed_Service, ROUND(SUM(CASE WHEN PricingModel IN ('Reservation', 'SavingsPlan') THEN CostInBillingCurrency ELSE 0 END) / SUM(CostInBillingCurrency), 2) * 100 AS Cost_Coverage_Percentage FROM AZURE_COST_USAGE WHERE (MetricType IN ('Amortized') AND ChargeType IN ('Usage') AND MeterCategory IN ('Virtual Machines', 'Container Instances', 'Azure App Service', 'Functions') AND ConsumedService IN ('Microsoft.Compute', 'Microsoft.ContainerInstance', 'microsoft.web', 'Microsoft.Batch', 'Microsoft.Kusto', 'Microsoft.MachineLearningServices')) GROUP BY timeInterval_Day, ConsumedService ORDER BY Day ASC"
    },
   {
     "name": "[CHPS] Azure Cost Coverage From RISP - Monthly",
     "description": "This report shows your Azure costs that are covered by an RI or SP.\n\nCreated by CloudHealth Professional Services.",
     "backlinking": "True",
     "dataGranularity": "MONTHLY",
     "timeRange": "12",
     "limit": "-1",
     "excludeCurrent": "True",
     "sqlStatement": "SELECT timeInterval_Month AS Month, ConsumedService AS Consumed_Service, ROUND(SUM(CASE WHEN PricingModel IN ('Reservation', 'SavingsPlan') THEN CostInBillingCurrency ELSE 0 END) / SUM(CostInBillingCurrency), 2) * 100 AS Cost_Coverage_Percentage FROM AZURE_COST_USAGE WHERE (MetricType IN ('Amortized')) AND (ChargeType IN ('Usage')) AND (MeterCategory IN ('Virtual Machines', 'Container Instances', 'Azure App Service', 'Functions')) GROUP BY timeInterval_Month, ConsumedService ORDER BY Month ASC"
    },
   {
     "name": "[CHPS] Azure Hours Coverage From RISP - Monthly",
     "description": "This report shows your monthly Azure hours that were covered by an RI or SP.\n\nCreated by CloudHealth Professional Services.",
     "backlinking": "True",
     "dataGranularity": "MONTHLY",
     "timeRange": "12",
     "limit": "-1",
     "excludeCurrent": "True",
     "sqlStatement": "SELECT timeInterval_Month AS Month ,ConsumedService AS Consumed_Service ,ROUND((SUM(CASE WHEN PricingModel IN ('Reservation') THEN Quantity ELSE 0 END) ), 2) AS RI_Covered_Hours ,ROUND((SUM(CASE WHEN PricingModel IN ('SavingsPlan') THEN Quantity ELSE 0 END) ), 2) AS Savings_Plan_Covered_Hours ,ROUND((SUM(CASE WHEN PricingModel IN ('OnDemand','Spot') THEN Quantity ELSE 0 END) ), 2) AS PAYG_Hours ,ROUND((SUM(CASE WHEN PricingModel IN ('Reservation') THEN Quantity ELSE 0 END) / SUM(Quantity) * 100 ), 2) AS RI_Hours_Coverage_Percentage ,ROUND((SUM(CASE WHEN PricingModel IN ('SavingsPlan') THEN Quantity ELSE 0 END) / SUM(Quantity) * 100 ), 2) AS SP_Hours_Coverage_Percentage ,(SUM(CASE WHEN PricingModel IN ('Reservation') THEN Quantity ELSE 0 END) / SUM(Quantity) * 100 + SUM(CASE WHEN PricingModel IN ('SavingsPlan') THEN Quantity ELSE 0 END) / SUM(Quantity) * 100) AS Total_Coverage_Percentage FROM AZURE_COST_USAGE WHERE (MetricType IN ('Amortized') AND ChargeType IN ('Usage') AND MeterCategory IN ('Virtual Machines','Container Instances','Azure App Service','Functions') AND (ConsumedService IN ('Microsoft.Compute','microsoft.web','Microsoft.ContainerInstance','Microsoft.Batch','Microsoft.Kusto','Microsoft.MachineLearningServices') ) ) GROUP BY timeInterval_Month ,ConsumedService ORDER BY TimeInterval_Month ASC"
    },
   {
     "name": "[CHPS] Azure Savings From RISP - Daily",
     "description": "This report shows your daily Azure savings from RI or SP.\n\nCreated by CloudHealth Professional Services.",
     "backlinking": "True",
     "dataGranularity": "DAILY",
     "timeRange": "30",
     "limit": "-1",
     "excludeCurrent": "True",
     "sqlStatement": "SELECT timeInterval_Day AS Day, SubscriptionName AS Subscription_Name, ROUND((UnitPrice * SUM(Quantity) - SUM(CostInReportingCurrency)), 2) AS SavingsFromRIorSP,  PricingModel AS Pricing_Model, BenefitName AS RIorSP_Name, ConsumedService AS Consumed_Service FROM AZURE_COST_USAGE WHERE ((PricingModel LIKE '%Reservation%') OR (PricingModel LIKE '%SavingsPlan%')) AND (MetricType LIKE '%Amortized%') GROUP BY timeInterval_Day, SubscriptionName, UnitPrice, PricingModel, ConsumedService,  BenefitName ORDER BY timeInterval_Day ASC"
    },
   {
     "name": "[CHPS] Azure Savings From RISP - Monthly",
     "description": "This report shows your monthly Azure savings from RI or SP.\n\nCreated by CloudHealth Professional Services.",
     "backlinking": "True",
     "dataGranularity": "MONTHLY",
     "timeRange": "12",
     "limit": "-1",
     "excludeCurrent": "True",
     "sqlStatement": "SELECT timeInterval_Month AS Month, SubscriptionName AS Subscription_Name,ROUND((UnitPrice * SUM(Quantity) - SUM(CostInReportingCurrency)), 2) AS SavingsFromRIorSP,  PricingModel AS Pricing_Model, BenefitName AS RIorSP_Name, ConsumedService AS Consumed_Service FROM AZURE_COST_USAGE WHERE ((PricingModel LIKE '%Reservation%') OR (PricingModel LIKE '%SavingsPlan%')) AND (MetricType LIKE '%Amortized%')  GROUP BY timeInterval_Month, SubscriptionName, UnitPrice, PricingModel, ConsumedService,  BenefitName ORDER BY timeInterval_Month ASC"
    },
   {
     "name": "[CHPS] Azure Savings Plan Consumption - Daily",
     "description": "This report shows your daily Azure commitment discount consumption.\n\nCreated by CloudHealth Professional Services.",
     "backlinking": "True",
     "dataGranularity": "DAILY",
     "timeRange": "90",
     "limit": "-1",
     "excludeCurrent": "True",
     "sqlStatement": "SELECT timeInterval_Day AS Day, SubscriptionName AS Subscription_Name, ConsumedService AS Consumed_Service, BenefitName AS Benefit_Name, SUM(CostInBillingCurrency) AS Amortised_Cost FROM AZURE_COST_USAGE WHERE (MetricType = 'Amortized') AND (BenefitId LIKE '%savingsPlan%') AND (ChargeType NOT LIKE '%UnusedSavingsPlan%') GROUP BY timeInterval_Day, SubscriptionName, ConsumedService, BenefitName, ChargeType ORDER BY Day ASC"
    },
   {
     "name": "[CHPS] Azure Savings Plan Consumption - Monthly",
     "description": "This report shows your monthly Azure commitment discount consumption.\n\nCreated by CloudHealth Professional Services.",
     "backlinking": "True",
     "dataGranularity": "MONTHLY",
     "timeRange": "12",
     "limit": "-1",
     "excludeCurrent": "True",
     "sqlStatement": "SELECT timeInterval_Month AS Month, SubscriptionName AS Subscription_Name, ConsumedService AS Consumed_Service, BenefitName AS Benefit_Name, SUM(CostInBillingCurrency) AS Amortised_Cost, ChargeType AS Charge_Type FROM AZURE_COST_USAGE WHERE (MetricType = 'Amortized') AND (BenefitId LIKE '%savingsPlan%') AND (ChargeType NOT LIKE '%UnusedSavingsPlan%') GROUP BY timeInterval_Month, SubscriptionName, ConsumedService, BenefitName, ChargeType ORDER BY Month ASC"
    },
   {
     "name": "[CHPS] Azure VM PAYG Cost and Hours - Daily",
     "description": "This report shows your daily Azure PAYG/on-demand costs.\n\nCreated by CloudHealth Professional Services.",
     "backlinking": "True",
     "dataGranularity": "DAILY",
     "timeRange": "90",
     "limit": "-1",
     "excludeCurrent": "True",
     "sqlStatement": "SELECT timeInterval_Day AS Day, SubscriptionName AS Subscription_Name, MeterCategory AS MeterCategory, MeterName AS MeterName, MeterSubCategory AS MeterSubCategory, ConsumedService AS Consumed_Service, CAST(SUM(Quantity) AS DECIMAL(12, 1)) AS PAYG_Hours, MeterRegion AS MeterRegion, SUM(CostInBillingCurrency) AS PAYG_Cost FROM AZURE_COST_USAGE WHERE ((ConsumedService IN ('Microsoft.Compute')) OR (ConsumedService IN ('microsoft.web')) OR (ConsumedService IN ('Microsoft.Capacity')) OR (ConsumedService IN ('Microsoft.ContainerInstance')) OR (ConsumedService IN ('Microsoft.Batch')) OR (ConsumedService IN ('Microsoft.Kusto')) OR (ConsumedService IN ('Microsoft.MachineLearningServices'))) AND (PricingModel IN ('OnDemand')) AND ((MeterCategory IN ('Virtual Machines')) OR (MeterCategory IN ('Azure App Service')) OR (MeterCategory IN ('Container Instances')) OR (MeterCategory IN ('Functions'))) AND (MeterSubCategory NOT LIKE '%Free Plan%') AND (MetricType IN ('Actual')) GROUP BY timeInterval_Day, SubscriptionName, MeterCategory, MeterSubCategory, ConsumedService, MeterRegion, MeterName ORDER BY Day ASC"
    },
   {
     "name": "[CHPS] Azure VM PAYG Cost and Hours - Monthly",
     "description": "This report shows your Azure PAYG/on demand costs and are not covered by an RI or SP.\n\nCreated by CloudHealth Professional Services.",
     "backlinking": "True",
     "dataGranularity": "MONTHLY",
     "timeRange": "12",
     "limit": "-1",
     "excludeCurrent": "True",
     "sqlStatement": "SELECT timeInterval_Month AS Month, SubscriptionName AS Subscription_Name, MeterCategory AS MeterCategory, MeterSubCategory AS MeterSubCategory, ConsumedService AS Consumed_Service, CAST(SUM(Quantity) AS DECIMAL(12, 1)) AS PAYG_Hours, MeterRegion AS MeterRegion, SUM(CostInBillingCurrency) AS COST FROM AZURE_COST_USAGE WHERE MetricType LIKE 'Amortized' AND ((ConsumedService IN ('Microsoft.Compute')) OR (ConsumedService IN ('microsoft.web')) OR (ConsumedService IN ('Microsoft.Capacity')) OR (ConsumedService IN ('Microsoft.ContainerInstance')) OR (ConsumedService IN ('Microsoft.Batch')) OR (ConsumedService IN ('Microsoft.Kusto')) OR (ConsumedService IN ('Microsoft.MachineLearningServices'))) AND (PricingModel IN ('OnDemand')) AND ((MeterCategory IN ('Virtual Machines')) OR (MeterCategory IN ('Azure App Service')) OR (MeterCategory IN ('Container Instances')) OR (MeterCategory IN ('Functions'))) AND (MeterSubCategory NOT LIKE '%Free Plan%') GROUP BY timeInterval_Month, SubscriptionName, MeterCategory, MeterSubCategory, ConsumedService, MeterRegion ORDER BY Month ASC"
    }, 
    {
     "name": "[CHPS] Azure Unused Savings Plans - Daily",
     "description": "This report shows your daily unused Azure Savings Plan costs.\n\nCreated by CloudHealth Professional Services.",
     "backlinking": "True",
     "dataGranularity": "DAILY",
     "timeRange": "30",
     "limit": "-1",
     "excludeCurrent": "True",
     "sqlStatement": "SELECT timeInterval_Day AS Day, ROUND(SUM(CostInBillingCurrency),2) AS Unused_Benefit, BenefitName AS Benefit_Name FROM AZURE_COST_USAGE WHERE (ChargeType IN ('UnusedSavingsPlan')) GROUP BY timeInterval_Day, BenefitName ORDER BY Day ASC"
    },
    {
     "name": "[CHPS] AWS Unused VPCs",
     "description": "This report shows AWS VPCs with no data transfer costs last month.\n\nCreated by CloudHealth Professional Services.",
     "backlinking": "True",
     "dataGranularity": "MONTHLY",
     "timeRange": "1",
     "limit": "-1",
     "excludeCurrent": "True",
     "sqlStatement": "WITH \"cxtemp_VPC\" AS ( SELECT timeInterval_Month AS Month, lineItem_ResourceId AS LineItem_ResourceId, organization.\"accountname\" AS Organization_accountname, round( SUM( CASE WHEN lineItem_UsageType LIKE '%VpcEndpoint-Hour%' THEN lineItem_UnblendedCost ELSE 0 END ), 2 ) AS VPC_Hours_Cost, SUM( CASE WHEN lineItem_UsageType LIKE '%VpcEndpoint-Byte%' THEN lineItem_UnblendedCost ELSE 0 END ) AS VPC_Transfer_Cost FROM AWS_CUR WHERE (lineItem_ResourceId LIKE '%vpc-endpoint%') GROUP BY timeInterval_Month, lineItem_ResourceId, organization.\"accountname\" ) SELECT Month, Organization_accountname, LineItem_ResourceId, VPC_Hours_Cost, VPC_Transfer_Cost FROM cxtemp_VPC WHERE VPC_Hours_Cost > 0 AND VPC_Transfer_Cost = 0 ORDER BY Month, Organization_accountname, LineItem_ResourceId"
    },
    {
     "name": "[CHPS] TEST Azure Workload Consistency",
     "description": "This report shows Azure workloads and their month-over-month duration.\n\nCreated by CloudHealth Professional Services.",
     "backlinking": "True",
     "dataGranularity": "MONTHLY",
     "timeRange": "12",
     "limit": "-1",
     "excludeCurrent": "False",
     "sqlStatement": "WITH cxtemp_months AS ( SELECT timeInterval_Month AS Month, DATE_DIFF ( 'hour', FROM_ISO8601_TIMESTAMP (timeInterval_Month), FROM_ISO8601_TIMESTAMP ( LAG (timeInterval_Month, 1) OVER ( ORDER BY timeInterval_Month DESC ) ) ) AS Total_Hours_In_Month FROM AZURE_COST_USAGE GROUP BY timeInterval_Month ), cxtemp_vm_by_month AS ( SELECT timeInterval_Month AS TimeInterval_Month, SUM(Quantity) AS SUM_Quantity, SUM(CostInBillingCurrency) AS SUM_CostInBillingCurrency, SUM(ActualCostInBillingCurrency) AS SUM_ActualCostInBillingCurrency, SUM(AmortizedCostInBillingCurrency) AS SUM_AmortizedCostInBillingCurrency, ResourceId AS ResourceId, MAX(cxtemp_months.Total_Hours_In_Month) AS Total_Hours_In_Month, LAG (timeInterval_month, 1) OVER ( PARTITION BY ResourceId ORDER BY timeInterval_Month ASC ) AS Exists_In_Previous_Month, LAG (timeInterval_month, 1) OVER ( PARTITION BY ResourceId ORDER BY timeInterval_Month DESC ) AS Exists_In_Next_Month FROM AZURE_COST_USAGE LEFT JOIN cxtemp_months ON timeInterval_Month = cxtemp_months.Month WHERE (MeterCategory IN ('Virtual Machines')) AND (ConsumedService IN ('Microsoft.Compute')) AND (MetricType IN ('Amortized')) GROUP BY ResourceId, timeInterval_Month ORDER BY TimeInterval_Month ASC ) SELECT 1 AS NumberVMs, TimeInterval_Month, SUM_Quantity, SUM_CostInBillingCurrency, SUM_ActualCostInBillingCurrency, SUM_AmortizedCostInBillingCurrency, ResourceId, CASE WHEN Exists_In_Previous_Month IS NULL AND Exists_In_Next_Month IS NULL THEN 'Ephemeral Workload' WHEN Exists_In_Previous_Month IS NOT NULL AND Exists_In_Next_Month IS NULL THEN 'Deleted' WHEN Exists_In_Previous_Month IS NULL AND Exists_In_Next_Month IS NOT NULL THEN 'New Workload' WHEN Exists_In_Previous_Month IS NOT NULL AND Exists_In_Next_Month IS NOT NULL AND SUM_Quantity >= 0.9 * Total_Hours_In_Month THEN '24/7 Workload' WHEN Exists_In_Previous_Month IS NOT NULL AND Exists_In_Next_Month IS NOT NULL AND SUM_Quantity < 0.9 * Total_Hours_In_Month THEN 'Existing Workload' ELSE 'Unknown' END AS STATUS FROM cxtemp_vm_by_month WHERE TimeInterval_Month > ( SELECT MIN(TimeInterval_Month) FROM cxtemp_vm_by_month ) AND TimeInterval_Month < ( SELECT MAX(TimeInterval_Month) FROM cxtemp_vm_by_month ) ORDER BY ResourceId ASC"
    
    },
    {
     "name": "[CHPS] Multi-Cloud Cost History",
     "description": "This report shows your multi-cloud cost history.\n\nCreated by CloudHealth Professional Services.",
     "backlinking": "True",
     "dataGranularity": "MONTHLY",
     "timeRange": "12",
     "limit": "-1",
     "excludeCurrent": "False",
     "sqlStatement": "WITH cxtemp_AWS AS( SELECT 'AWS' AS Cloud ,timeInterval_Month AS Month ,SUM(lineItem_BlendedCost) AS Cost FROM AWS_CUR GROUP BY timeInterval_Month) ,cxtemp_AZURE AS ( SELECT 'Azure' AS Cloud ,timeInterval_Month AS Month ,SUM(AmortizedCostInBillingCurrency) AS Cost FROM AZURE_COST_USAGE GROUP BY timeInterval_Month ) SELECT Cloud ,Month ,Cost FROM cxtemp_AWS UNION ALL SELECT Cloud ,Month ,Cost FROM cxtemp_AZURE ORDER BY Month ,Cloud "
    },
    {
     "name": "[CHPS] AWS Unused Compute Savings Plans",
     "description": "This report shows your unused AWS Compute Savings Plans.\n\nCreated by CloudHealth Professional Services.",
     "backlinking": "True",
     "dataGranularity": "DAILY",
     "timeRange": "45",
     "limit": "-1",
     "excludeCurrent": "False",
     "sqlStatement": "SELECT timeInterval_Day AS Day, ROUND(SUM(savingsPlan_TotalCommitmentToDate), 2) as Total_Committed, ROUND(SUM(savingsPlan_UsedCommitment), 2) as Total_Used, ROUND( ( SUM( ( savingsPlan_TotalCommitmentToDate - savingsPlan_UsedCommitment ) ) * 0.7 ), 2 ) AS Total_Unused, product_ProductName AS Product_ProductName, lineItem_ProductCode AS LineItem_ProductCode FROM AWS_CUR WHERE ( product_ProductName LIKE '%Savings Plans for AWS Compute usage%' ) GROUP BY timeInterval_Day, product_ProductName, lineItem_ProductCode ORDER BY Day ASC "
    },
    {
     "name": "[CHPS] AWS VMs launched in the last 5 days",
     "description": "This report shows your AWS EC2 instances that were created in the last 5 days.\n\nCreated by CloudHealth Professional Services.",
     "backlinking": "False",
     "dataGranularity": "DAILY",
     "timeRange": "30",
     "limit": "-1",
     "excludeCurrent": "False",
     "sqlStatement": "WITH cxtemp_first_seen AS( SELECT MIN(timeInterval_Day) AS FirstSeenDate ,lineItem_ResourceId AS ResourceId ,product_instanceType AS InstanceType ,\"organization##accountname\" AS AccountName FROM AWS_CUR WHERE (lineItem_ResourceId IS NOT NULL) AND (product_productFamily IN ('Compute Instance')) GROUP BY lineItem_ResourceId ,product_instanceType ,\"organization##accountname\") ,cxtemp_recent_vms AS ( SELECT FirstSeenDate ,ResourceId ,InstanceType ,AccountName FROM cxtemp_first_seen WHERE date_diff('day', FirstSeenDate, CURRENT_DATE) <= 5 ) SELECT ResourceId ,AccountName ,InstanceType ,FirstSeenDate FROM cxtemp_recent_vms"
    },
    {
     "name": "[CHPS] Azure VMs launched in the last 5 days",
     "description": "This report shows your Azure VMs that were created in the last 5 days.\n\nCreated by CloudHealth Professional Services.",
     "backlinking": "False",
     "dataGranularity": "DAILY",
     "timeRange": "30",
     "limit": "-1",
     "excludeCurrent": "False",
     "sqlStatement": "WITH \"cxtemp_first_seen_vms\" AS( SELECT ResourceName AS ResourceName, SubscriptionName AS SubscriptionName, ResourceId AS ResourceId, MeterCategory AS MeterCategory, MIN(timeInterval_Day) AS FirstSeenDate FROM AZURE_COST_USAGE WHERE MeterCategory IN ('Virtual Machines') AND ResourceId NOT LIKE '%virtualMachineScaleSets%' AND ResourceId NOT LIKE '%capacityReservationGroups%' AND (Tags NOT LIKE '%Databricks%') GROUP BY ResourceName, SubscriptionName, ResourceId, MeterCategory), \"cxtemp_recent_first_seen_vms\" AS ( SELECT ResourceName, SubscriptionName, ResourceId, MeterCategory, FirstSeenDate FROM cxtemp_first_seen_vms WHERE date_diff ('day', FirstSeenDate, current_date) <= 5 ) SELECT ResourceName, SubscriptionName, ResourceId, MeterCategory, FirstSeenDate FROM \"cxtemp_recent_first_seen_vms\" ORDER BY FirstSeenDate ASC, ResourceName ASC "
    }

]